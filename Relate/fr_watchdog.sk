#WatchDog Ver A
#by Feiron Iguista (francoisifrig) from Corona Studio
#for SkMQi at https://github.com/fr1g/Skript_MiraiMC_QQbot_Interface/

on command "/rewaczero":
    sender has permission "admin":
        cancel event
        message "ã€å…±é¸£ã€‘å·²åŠ è½½çš„SkMQié™„å±ï¼šçœ‹é—¨ç‹— A"

command skr_watchdog:
    trigger:
        sender has permission "admin":
            set {wdg.group} to "114514"
            set {wdg.default.bot} to "1919810"
            wait 1 tick
            make sender execute command "/sk reload fr_watchdog"

command wd_bc_tg:
    aliases: åˆ‡æ¢çœ‹é—¨ç‹—å¹¿æ’­
    trigger:
        sender has permission "admin":
            if {showlogsingroup} is not true:
                send "çœ‹é—¨ç‹—å¹¿æ’­ï¼šæ˜¯"
                set {showlogsingroup} to true
            else:
                send "çœ‹é—¨ç‹—å¹¿æ’­ï¼šå¦"
                wait 3 ticks
                set {showlogsingroup} to false

command wd_group [<text>] [<text>]:
    trigger:
        sender has permission "admin":
            if arg-1 is not set:
                send "çœ‹é—¨ç‹—ï¼šæœ¬å‘½ä»¤éœ€è¦åœ¨ç¬¬ä¸€ä¸ªå‚æ•°è¾“å…¥æœºå™¨äººè´¦å· ç¬¬äºŒä¸ªå‚æ•°è¾“å…¥ç›®æ ‡ç¾¤å·ã€‚æ‰€æœ‰å‡æš‚ä¸”ä»…æ”¯æŒä¸€ä¸ªå€¼ã€‚"
            else:
                if arg-2 is not set:
                    send "çœ‹é—¨ç‹—ï¼šç¾¤å·æœªè¾“å…¥ã€‚é‡è¯•ã€‚"
                else:
                    set {wdg.group} to arg-2
                    set {wdg.default.bot} to arg-1


on log:
    # if log message end with "æ³•æ£":
    #     broadcast logger name
    #     stop

    if log level is fatal:
        make console execute command "/mirai sendgroupmessage %{wdg.default.bot}% %{wdg.group}% %log message%"
        stop

    if {showlogsingroup} is true:
        if logger name is "me.dreamvoid.miraimc.bukkit.BukkitPlugin":
            stop
        else:
            if log message contains "æœåŠ¡å™¨å¥½åƒä¸èƒ½ç†è§£ä½ çš„æ„æ€å‘¢ï¼Œ":#æœªçŸ¥æŒ‡ä»¤æŠ¥é”™çš„è¿”å› å¯èƒ½ä¼šè¢«æ¶æ å¾…è§£å†³
                if log message contains "[m":
                    make console execute command "/mirai sendgroupmessage %{wdg.default.bot}% %{wdg.group}% ä»€ä¹ˆä»€ä¹ˆ æˆ‘ä¸æ‡‚äº†ï¼"
                    stop
            else:
                set {_wdg.logmess} to log message
                replace all "[m" in {_wdg.logmess} with " "
                make console execute command "/mirai sendgroupmessage %{wdg.default.bot}% %{wdg.group}% %{_wdg.logmess}%"
                delete {_wdg.logmess}
                stop
